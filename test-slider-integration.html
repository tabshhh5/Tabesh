<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabesh Slider Integration Test</title>
    <style>
        body {
            font-family: 'Tahoma', 'Arial', sans-serif;
            direction: rtl;
            text-align: right;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .event-log {
            background: #fff;
            border: 2px solid #2563eb;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        .event-log h3 {
            margin-top: 0;
            color: #2563eb;
        }
        .log-entry {
            padding: 10px;
            margin: 5px 0;
            background: #f8fafc;
            border-right: 4px solid #2563eb;
            font-family: monospace;
            font-size: 12px;
        }
        .log-entry.new {
            animation: highlight 0.5s ease;
        }
        @keyframes highlight {
            0% { background: #dbeafe; }
            100% { background: #f8fafc; }
        }
        .state-display {
            background: #fff;
            border: 2px solid #10b981;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        .state-display h3 {
            margin-top: 0;
            color: #10b981;
        }
        .state-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .state-item {
            padding: 10px;
            background: #f0fdf4;
            border-radius: 4px;
        }
        .state-label {
            font-weight: bold;
            color: #059669;
            margin-bottom: 5px;
        }
        .state-value {
            color: #064e3b;
            font-family: monospace;
        }
        .instructions {
            background: #fff;
            border: 2px solid #f59e0b;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .instructions h2 {
            margin-top: 0;
            color: #f59e0b;
        }
        .instructions ol {
            line-height: 2;
        }
        .slider-simulation {
            background: #fff;
            border: 2px solid #8b5cf6;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        .slider-simulation h3 {
            margin-top: 0;
            color: #8b5cf6;
        }
        #mockSlider {
            width: 100%;
            height: 300px;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 24px;
            font-weight: bold;
            color: #64748b;
            transition: all 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ðŸ§ª Tabesh Slider Integration Test</h1>
        
        <div class="instructions">
            <h2>ðŸ“‹ Test Instructions</h2>
            <ol>
                <li>Add this shortcode to a WordPress page: <code>[tabesh_order_form_slider]</code></li>
                <li>Open browser console (F12) and navigate to the page</li>
                <li>Make selections in the order form</li>
                <li>Watch the event log below for dispatched events</li>
                <li>Verify the current state display updates correctly</li>
                <li>Check that <code>window.TabeshSlider.currentState</code> is accessible</li>
            </ol>
            <p><strong>Note:</strong> This test page demonstrates the JavaScript API. In production, integrate with Revolution Slider as shown in the documentation.</p>
        </div>

        <div class="slider-simulation">
            <h3>ðŸŽ¬ Mock Slider (Simulated)</h3>
            <div id="mockSlider">
                Waiting for form events...
            </div>
        </div>

        <div class="state-display">
            <h3>ðŸ“Š Current Form State</h3>
            <div class="state-grid" id="stateDisplay">
                <div class="state-item">
                    <div class="state-label">Status:</div>
                    <div class="state-value">Waiting for events...</div>
                </div>
            </div>
        </div>

        <div class="event-log">
            <h3>ðŸ“¡ Event Log</h3>
            <div id="eventLog"></div>
        </div>
    </div>

    <script>
        // Event listener for Tabesh slider updates
        let eventCount = 0;
        const maxLogEntries = 50;

        document.addEventListener('tabeshSliderUpdate', function(event) {
            eventCount++;
            const state = event.detail;
            
            // Log event
            logEvent(state);
            
            // Update state display
            updateStateDisplay(state);
            
            // Update mock slider
            updateMockSlider(state);
            
            // Log to console
            console.log('Tabesh Slider Event #' + eventCount + ':', state);
        });

        function logEvent(state) {
            const log = document.getElementById('eventLog');
            const entry = document.createElement('div');
            entry.className = 'log-entry new';
            
            const timestamp = new Date().toLocaleTimeString('fa-IR');
            entry.innerHTML = `
                <strong>[${timestamp}] Event #${eventCount}</strong><br>
                ${JSON.stringify(state, null, 2)}
            `;
            
            log.insertBefore(entry, log.firstChild);
            
            // Remove animation class after animation
            setTimeout(() => entry.classList.remove('new'), 500);
            
            // Limit log entries
            while (log.children.length > maxLogEntries) {
                log.removeChild(log.lastChild);
            }
        }

        function updateStateDisplay(state) {
            const display = document.getElementById('stateDisplay');
            display.innerHTML = '';
            
            const fields = [
                { key: 'book_size', label: 'Ù‚Ø·Ø¹ Ú©ØªØ§Ø¨' },
                { key: 'paper_type', label: 'Ù†ÙˆØ¹ Ú©Ø§ØºØ°' },
                { key: 'paper_weight', label: 'Ú¯Ø±Ù…Ø§Ú˜ Ú©Ø§ØºØ°' },
                { key: 'print_type', label: 'Ù†ÙˆØ¹ Ú†Ø§Ù¾' },
                { key: 'page_count', label: 'ØªØ¹Ø¯Ø§Ø¯ ØµÙØ­Ø§Øª' },
                { key: 'quantity', label: 'ØªÛŒØ±Ø§Ú˜' },
                { key: 'binding_type', label: 'Ù†ÙˆØ¹ ØµØ­Ø§ÙÛŒ' },
                { key: 'cover_weight', label: 'Ú¯Ø±Ù…Ø§Ú˜ Ø¬Ù„Ø¯' },
                { key: 'extras', label: 'Ø®Ø¯Ù…Ø§Øª Ø§Ø¶Ø§ÙÛŒ' }
            ];
            
            fields.forEach(field => {
                const value = state[field.key];
                const item = document.createElement('div');
                item.className = 'state-item';
                
                let displayValue = value;
                if (Array.isArray(value)) {
                    displayValue = value.length > 0 ? value.join(', ') : '-';
                } else if (value === null || value === undefined || value === '') {
                    displayValue = '-';
                }
                
                item.innerHTML = `
                    <div class="state-label">${field.label}:</div>
                    <div class="state-value">${displayValue}</div>
                `;
                display.appendChild(item);
            });
            
            // Add price if calculated
            if (state.calculated_price) {
                const item = document.createElement('div');
                item.className = 'state-item';
                item.style.gridColumn = 'span 2';
                item.innerHTML = `
                    <div class="state-label">Ù‚ÛŒÙ…Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯Ù‡:</div>
                    <div class="state-value">
                        ${state.calculated_price.total_price ? state.calculated_price.total_price.toLocaleString('fa-IR') + ' ØªÙˆÙ…Ø§Ù†' : '-'}
                    </div>
                `;
                display.appendChild(item);
            }
        }

        function updateMockSlider(state) {
            const slider = document.getElementById('mockSlider');
            
            // Simulate slide change based on form state
            let slideText = 'ÙØ±Ù… Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø± Ø´Ø¯Ù†...';
            
            if (state.book_size && state.paper_type) {
                slideText = `Ø§Ø³Ù„Ø§ÛŒØ¯: ${state.book_size} - ${state.paper_type}`;
                
                if (state.print_type) {
                    slideText += ` - ${state.print_type === 'color' ? 'Ø±Ù†Ú¯ÛŒ' : 'Ø³ÛŒØ§Ù‡ Ùˆ Ø³ÙÛŒØ¯'}`;
                }
                
                // Change background color based on print type
                if (state.print_type === 'color') {
                    slider.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                    slider.style.color = '#fff';
                } else if (state.print_type === 'bw') {
                    slider.style.background = 'linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)';
                    slider.style.color = '#333';
                } else {
                    slider.style.background = '#f5f5f5';
                    slider.style.color = '#64748b';
                }
            }
            
            slider.textContent = slideText;
        }

        // Check for initial state on page load
        setTimeout(() => {
            if (window.TabeshSlider && window.TabeshSlider.currentState) {
                console.log('Initial state available:', window.TabeshSlider.currentState);
                updateStateDisplay(window.TabeshSlider.currentState);
                updateMockSlider(window.TabeshSlider.currentState);
            }
        }, 1000);

        // Add some initial instructions to log
        setTimeout(() => {
            const log = document.getElementById('eventLog');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `
                <strong>[System] Test Page Loaded</strong><br>
                Waiting for form events from [tabesh_order_form_slider] shortcode...<br>
                Event listener is active and ready.
            `;
            log.appendChild(entry);
        }, 100);
    </script>
</body>
</html>
