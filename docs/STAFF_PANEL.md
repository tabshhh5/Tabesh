# پنل کارمندان - راهنمای استفاده

## نمای کلی

پنل کارمندان Tabesh یک رابط کاربری مدرن و پویا برای مدیریت سفارشات چاپ کتاب است که با شورتکد `[tabesh_staff_panel]` فعال می‌شود.

## ویژگی‌های اصلی

### 1. هدر پنل
- **عکس پروفایل**: نمایش آواتار کاربر
- **نام کارمند**: نمایش نام کامل کاربر
- **پیام خوشآمدگویی**: "خوش آمدید به پنل کارمندان"
- **دکمه تم**: تغییر بین حالت روشن و تاریک
- **دکمه اعلان**: برای نوتیفیکیشن‌ها (آماده برای توسعه آینده)
- **دکمه خروج**: خروج از حساب کاربری

### 2. نوار جستجوی سراسری
- جستجوی زنده (Live Search) با تأخیر 500 میلی‌ثانیه
- جستجو در موارد زیر:
  - شماره سفارش
  - عنوان کتاب
  - قطع کتاب
  - نام مشتری
  - سایر مشخصات
- مرتب‌سازی نتایج بر اساس مرتبط‌ترین به کم‌مرتبط‌ترین
- نمایش تدریجی نتایج (3 مورد در هر بار)
- دکمه "نمایش بیشتر" برای نمایش نتایج اضافی

### 3. کارت‌های سفارش

#### حالت بسته (Collapsed)
کارت‌های بسته شامل اطلاعات زیر هستند:
- شماره سفارش
- عنوان کتاب
- قطع کتاب
- تیراژ
- وضعیت فعلی

#### حالت باز (Expanded)
با کلیک روی هر کارت، اطلاعات کامل نمایش داده می‌شود:
- اطلاعات مشتری (فقط نام)
- تاریخ و ساعت ثبت سفارش
- مشخصات فنی کتاب:
  - قطع کتاب
  - نوع کاغذ و گرماژ
  - نوع چاپ
  - تعداد صفحات (رنگی، سیاه، کل)
  - تیراژ
  - نوع صحافی
  - نوع سلفون
  - اطلاعات جلد
  - نوع مجوز
- خدمات اضافی (در صورت وجود)
- توضیحات سفارش (در صورت وجود)
- **مبلغ کل** (فقط برای مدیران قابل مشاهده)

### 4. استپر وضعیت (Status Stepper)
نمایش مرحله‌ای پیشرفت سفارش:
1. در انتظار
2. تایید شده
3. در حال چاپ
4. آماده
5. تحویل

- مراحل گذشته با رنگ آبی و علامت تیک نمایش داده می‌شوند
- مرحله فعلی با رنگ آبی برجسته می‌شود
- کلیک روی هر مرحله، وضعیت را در منوی انتخاب تنظیم می‌کند

### 5. به‌روزرسانی وضعیت
- انتخاب وضعیت جدید از منوی کشویی
- دکمه "به‌روزرسانی وضعیت" برای ثبت تغییرات
- تأییدیه قبل از تغییر وضعیت
- به‌روزرسانی بدون بارگذاری مجدد صفحه (AJAX)
- نمایش پیام موفقیت یا خطا

### 6. تم‌های رنگی

#### حالت روشن (Light Mode)
- پس‌زمینه: سفید و خاکستری روشن
- گرادیان طلایی-آبی
- سایه‌های ملایم

#### حالت تاریک (Dark Mode)
- پس‌زمینه: تیره با رنگ‌های آبی و بنفش
- گرادیان طلایی-آبی
- سایه‌های عمیق‌تر

تم انتخابی در مرورگر ذخیره می‌شود و در بازدیدهای بعدی حفظ می‌ماند.

## امنیت و دسترسی

### سطوح دسترسی

#### کارمندان (`edit_shop_orders`)
- مشاهده تمام سفارشات فعال
- تغییر وضعیت سفارشات
- **عدم دسترسی** به اطلاعات مالی
- **عدم دسترسی** به اطلاعات تماس و آدرس مشتری

#### مدیران (`manage_woocommerce`)
- تمام دسترسی‌های کارمندان
- مشاهده مبالغ سفارشات
- دسترسی به تمام اطلاعات

### امنیت
- استفاده از nonce برای تمام درخواست‌های AJAX
- بررسی دسترسی در سمت سرور
- Sanitization و Escaping تمام ورودی‌ها و خروجی‌ها
- ثبت نام کاربر در تغییرات وضعیت

## نصب و راه‌اندازی

### 1. افزودن شورتکد
در صفحه یا پست مورد نظر، شورتکد زیر را اضافه کنید:

```
[tabesh_staff_panel]
```

### 2. تخصیص نقش
به کاربران مورد نظر، نقش "Shop Manager" یا capability `edit_shop_orders` را اختصاص دهید.

### 3. تنظیمات REST API
اطمینان حاصل کنید که REST API وردپرس فعال است و دسترسی‌های لازم برقرار است.

## توسعه و سفارشی‌سازی

### فایل‌های مرتبط
- **Template**: `templates/frontend/staff-panel.php`
- **CSS**: `assets/css/staff-panel.css`
- **JavaScript**: `assets/js/staff-panel.js`
- **Handler Class**: `includes/handlers/class-tabesh-staff.php`

### CSS Variables
می‌توانید با تغییر CSS Variables، رنگ‌بندی پنل را سفارشی کنید:

```css
:root {
    --bg-primary: #f0f2f5;
    --accent-blue: #4a90e2;
    --accent-gold: #ffd700;
    --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}
```

### JavaScript Hooks
برای افزودن عملکردهای سفارشی، می‌توانید از رویدادهای jQuery استفاده کنید:

```javascript
$(document).on('tabesh_status_updated', function(event, orderId, newStatus) {
    // Custom code here
});
```

## عیب‌یابی

### مشکلات رایج

1. **پنل نمایش داده نمی‌شود**
   - بررسی کنید که کاربر دسترسی `edit_shop_orders` دارد
   - بررسی کنید که WooCommerce نصب و فعال است

2. **جستجو کار نمی‌کند**
   - کنسول مرورگر را برای خطاهای JavaScript بررسی کنید
   - اطمینان حاصل کنید که jQuery بارگذاری شده است

3. **تغییر وضعیت ذخیره نمی‌شود**
   - بررسی REST API با دسترسی به `/wp-json/tabesh/v1/`
   - بررسی خطاهای نمایش داده شده در توست

4. **تم تاریک کار نمی‌کند**
   - پاک کردن Local Storage مرورگر
   - بررسی کنید که JavaScript فعال است

### Debug Mode
برای فعال کردن حالت دیباگ:

```php
define('WP_DEBUG', true);
define('WP_DEBUG_LOG', true);
```

لاگ‌ها در `wp-content/debug.log` ذخیره می‌شوند.

## سوالات متداول

### آیا می‌توان چند کارمند داشت؟
بله، تعداد نامحدود کارمند می‌توانند از پنل استفاده کنند.

### آیا کارمندان می‌توانند قیمت‌ها را ببینند؟
خیر، اطلاعات مالی فقط برای مدیران قابل مشاهده است.

### آیا تغییرات وضعیت ثبت می‌شود؟
بله، تمام تغییرات وضعیت با نام کاربر و زمان در دیتابیس ثبت می‌شود.

### آیا پنل با موبایل سازگار است؟
بله، پنل کاملاً responsive و با تمام دستگاه‌ها سازگار است.

## پشتیبانی

برای گزارش باگ یا درخواست ویژگی جدید، به مخزن GitHub مراجعه کنید:
https://github.com/tabshhh12/Tabesh

## مجوز

این افزونه تحت مجوز GPL v2 یا بالاتر منتشر شده است.
