# فرم ثبت سفارش V2 - مستندات طراحی مدرن

## خلاصه تغییرات

### ✅ تکمیل شده (100%)

#### 1. رفع مشکلات فنی هسته
- ✅ Ghost IDs در ماتریس قیمت‌گذاری برطرف شد
- ✅ محاسبه قیمت برای قطع‌های فارسی اصلاح شد
- ✅ eval() حذف شد (CSP compliance)
- ✅ سازگاری متادیتای V1/V2 تأیید شد
- ✅ اعلان‌های SMS کار می‌کنند

#### 2. بازطراحی کامل رابط کاربری
- ✅ Wizard تک‌صفحه‌ای با 4 مرحله
- ✅ نوار پیشرفت انیمیشن‌دار
- ✅ دکمه‌های ناوبری بعدی/قبلی
- ✅ طراحی مدرن و پویا
- ✅ Responsive برای موبایل
- ✅ انتخاب‌های بصری (کارت‌ها)

## ساختار Wizard

### مرحله 1: اطلاعات اولیه
```
┌─────────────────────────────────────┐
│  📖 اطلاعات اولیه کتاب              │
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────┐   │
│  │ عنوان کتاب (*)             │   │
│  └─────────────────────────────┘   │
│                                     │
│  انتخاب قطع کتاب (*)               │
│  ┌────┐  ┌────┐  ┌────┐  ┌────┐   │
│  │ A5 │  │ A4 │  │رقعی│  │وزیری│  │
│  └────┘  └────┘  └────┘  └────┘   │
│                                     │
└─────────────────────────────────────┘
          [قبلی]        [بعدی →]
```

### مرحله 2: مشخصات کاغذ و چاپ
```
┌─────────────────────────────────────┐
│  📄 مشخصات کاغذ و چاپ               │
├─────────────────────────────────────┤
│                                     │
│  نوع کاغذ (*)    │  گرماژ کاغذ (*) │
│  ┌─────────────┐ │  ┌────────────┐ │
│  │ انتخاب...  ▼│ │  │ انتخاب... ▼│ │
│  └─────────────┘ │  └────────────┘ │
│                                     │
│  نوع چاپ (*)                        │
│  ┌───────────────┐ ┌──────────────┐│
│  │ ⚫ سیاه‌وسفید  │ │ 🎨 رنگی     ││
│  └───────────────┘ └──────────────┘│
│                                     │
│  تعداد صفحات (*) │  تیراژ (*)      │
│  ┌─────────────┐ │  ┌────────────┐ │
│  │ 100         │ │  │ 10         │ │
│  └─────────────┘ │  └────────────┘ │
│                                     │
└─────────────────────────────────────┘
      [← قبلی]        [بعدی →]
```

### مرحله 3: صحافی و جلد
```
┌─────────────────────────────────────┐
│  📚 صحافی و جلد                     │
├─────────────────────────────────────┤
│                                     │
│  نوع صحافی (*)                      │
│  ┌─────────────────────────────┐   │
│  │ انتخاب کنید...            ▼│   │
│  └─────────────────────────────┘   │
│                                     │
│  گرماژ کاغذ جلد (*)                 │
│  ┌─────────────────────────────┐   │
│  │ انتخاب کنید...            ▼│   │
│  └─────────────────────────────┘   │
│                                     │
│  خدمات اضافی                        │
│  ┌────────┐ ┌────────┐ ┌────────┐ │
│  │☑ لب‌گرد│ │☐ خط‌تا │ │☐ شیرینک│ │
│  └────────┘ └────────┘ └────────┘ │
│                                     │
└─────────────────────────────────────┘
      [← قبلی]        [بعدی →]
```

### مرحله 4: بررسی و ثبت
```
┌─────────────────────────────────────┐
│  ✅ بررسی نهایی و ثبت سفارش         │
├─────────────────────────────────────┤
│                                     │
│  ┌─ خلاصه قیمت ───────────────┐    │
│  │ قیمت هر جلد:    50,000 تومان│    │
│  │ تعداد:                    10│    │
│  │ ═══════════════════════════ │    │
│  │ جمع کل:       500,000 تومان│    │
│  │                             │    │
│  │    [محاسبه قیمت]           │    │
│  └─────────────────────────────┘    │
│                                     │
│  ┌─ جزئیات سفارش ─────────────┐    │
│  │ عنوان کتاب: کتاب من        │    │
│  │ قطع کتاب: وزیری            │    │
│  │ نوع کاغذ: تحریر             │    │
│  │ ...                         │    │
│  └─────────────────────────────┘    │
│                                     │
│  توضیحات (اختیاری)                  │
│  ┌─────────────────────────────┐   │
│  │                             │   │
│  └─────────────────────────────┘   │
│                                     │
└─────────────────────────────────────┘
      [← قبلی]      [✓ ثبت سفارش]
```

## ویژگی‌های طراحی

### رنگ‌بندی
- **Primary**: آبی (#2563eb)
- **Success**: سبز (#10b981)
- **Secondary**: خاکستری (#64748b)
- **Background**: سفید با سایه‌های ملایم

### انیمیشن‌ها
- Fade in برای تغییر مراحل
- Transform برای hover روی کارت‌ها
- Progress bar با transition نرم
- Loading spinner چرخشی

### Responsive
- Desktop: 3-4 ستونی برای کارت‌ها
- Tablet: 2 ستونی
- Mobile: تک ستونی با padding کمتر

### Accessibility
- Label‌های واضح
- Focus states
- Error messages
- ARIA attributes

## دستورالعمل استفاده

### نصب
```php
// در صفحه یا پست WordPress:
[tabesh_order_form_v2]
```

### نیازمندی‌ها
- WordPress 6.8+
- WooCommerce (فعال)
- PHP 8.2+
- jQuery (بارگذاری خودکار)

### فایل‌ها
- Template: `templates/frontend/order-form-v2.php`
- CSS: `assets/css/order-form-v2.css`
- JS: `assets/js/order-form-v2.js`

## مشخصات فنی

### API Endpoints
- `POST /wp-json/tabesh/v1/get-allowed-options`
- `POST /wp-json/tabesh/v1/calculate-price`
- `POST /wp-json/tabesh/v1/submit-order`

### Form State
```javascript
{
  book_title: '',
  book_size: '',
  paper_type: '',
  paper_weight: '',
  print_type: '',
  page_count: 100,
  quantity: 10,
  binding_type: '',
  cover_weight: '',
  extras: [],
  notes: '',
  calculated_price: null
}
```

### Validation
- هر مرحله قبل از رفتن به مرحله بعد validate می‌شود
- پیام‌های خطای فارسی
- جلوگیری از submit بدون محاسبه قیمت

## تست

### سناریوهای تست
1. ✅ باز کردن فرم
2. ✅ انتخاب قطع کتاب
3. ✅ تغییر نوع کاغذ و بارگذاری گرماژها
4. ✅ ناوبری بین مراحل
5. ✅ محاسبه قیمت
6. ✅ ثبت سفارش
7. ✅ نمایش در موبایل

### مرورگرها
- ✅ Chrome/Edge (Chromium)
- ✅ Firefox
- ✅ Safari
- ✅ موبایل (iOS/Android)

## نتیجه‌گیری

فرم ثبت سفارش V2 به طور کامل بازطراحی شده و اکنون:
- رابط کاربری مدرن و حرفه‌ای دارد
- تجربه کاربری بهتری ارائه می‌دهد
- با تمام دستگاه‌ها سازگار است
- محاسبه قیمت صحیح کار می‌کند
- آماده استفاده در production است
