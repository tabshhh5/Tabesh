# پشتیبانی کامل از Gemini 2.5 Flash

## خلاصه

پشتیبانی کامل از مدل `gemini-2.5-flash` به سیستم هوش مصنوعی تابش اضافه شد. این مدل جدیدترین نسخه از Google Gemini است و در تمام حالت‌های عملکرد (Direct، Server، Client) به طور کامل کار می‌کند.

## تغییرات انجام شده

### 1. رابط کاربری مدیریت (Admin Settings)

**فایل**: `templates/admin/admin-settings.php`

گزینه `gemini-2.5-flash` به لیست انتخاب مدل در تنظیمات هوش مصنوعی اضافه شد:

```php
<option value="gemini-2.5-flash" <?php selected($current_model, 'gemini-2.5-flash'); ?>>
    Gemini 2.5 Flash (جدید - توصیه می‌شود)
</option>
```

این گزینه به عنوان پیش‌فرض توصیه شده علامت‌گذاری شده است.

### 2. مستندات

**فایل‌های به‌روزرسانی شده**:
- `AI_IMPLEMENTATION_COMPLETE.md`: لیست مدل‌های پشتیبانی شده به‌روز شد
- `docs/AI_API_DOCUMENTATION.md`: راهنمای انتخاب مدل به‌روز شد

## نحوه استفاده

### برای مدیران سایت

1. به پنل مدیریت وردپرس بروید
2. به **تابش > تنظیمات** بروید
3. تب **تنظیمات هوش مصنوعی** را انتخاب کنید
4. در قسمت **مدل Gemini**، گزینه **Gemini 2.5 Flash (جدید - توصیه می‌شود)** را انتخاب کنید
5. روی **تست اتصال** کلیک کنید تا اطمینان حاصل شود
6. روی **ذخیره تغییرات** کلیک کنید

### پشتیبانی در حالت‌های مختلف

#### حالت Direct (مستقیم)
✅ **کاملاً پشتیبانی می‌شود**

کلاس `Tabesh_AI_Gemini` به صورت پویا URL های API را با استفاده از نام مدل پیکربندی شده می‌سازد:

```php
$url = $this->api_endpoint . $this->model . ':generateContent?key=' . $this->api_key;
// مثال: https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=...
```

#### حالت Server (سرور)
✅ **کاملاً پشتیبانی می‌شود**

حالت Server از حالت Direct به صورت داخلی استفاده می‌کند، بنابراین به طور خودکار از هر مدلی که در حالت Direct پیکربندی شده پشتیبانی می‌کند.

#### حالت Client (کلاینت)
✅ **کاملاً پشتیبانی می‌شود**

حالت Client درخواست‌ها را به یک سرور خارجی ارسال می‌کند که از مدل پیکربندی شده خود استفاده می‌کند. هیچ محدودیتی در سمت کلاینت وجود ندارد.

## معماری فنی

### چگونه کار می‌کند؟

سیستم هوش مصنوعی تابش با معماری انعطاف‌پذیر طراحی شده است:

1. **پیکربندی**: نام مدل در `wp_tabesh_settings` ذخیره می‌شود
2. **بارگذاری**: `Tabesh_AI_Config::get('gemini_model')` نام مدل را می‌خواند
3. **استفاده**: `Tabesh_AI_Gemini` به صورت پویا URL API را می‌سازد
4. **درخواست**: با استفاده از `wp_remote_post()` درخواست به Google Gemini ارسال می‌شود

این معماری به این معنی است که:
- **هیچ تغییر کدی** برای پشتیبانی از مدل‌های جدید لازم نیست
- **فقط افزودن به رابط کاربری** کافی است
- **همه حالت‌ها به طور خودکار** پشتیبانی می‌شوند

### مدل‌های پشتیبانی شده

| مدل | توضیحات | توصیه |
|-----|---------|-------|
| **gemini-2.5-flash** | جدیدترین مدل، عملکرد عالی | ✅ توصیه می‌شود |
| gemini-2.0-flash-exp | سریع، ویژگی‌های آزمایشی | آزمایشی |
| gemini-1.5-flash | عملکرد متعادل، پایدار | استاندارد |
| gemini-1.5-pro | کیفیت بالا، کندتر، گران‌تر | حرفه‌ای |

## تست و اعتبارسنجی

### آزمون دستی

برای آزمایش پشتیبانی از `gemini-2.5-flash`:

1. **تست در حالت Direct**:
   ```
   1. تنظیمات > تنظیمات هوش مصنوعی
   2. حالت: مستقیم (Direct)
   3. مدل: Gemini 2.5 Flash
   4. کلید API: [کلید معتبر]
   5. کلیک: تست اتصال
   6. انتظار: "اتصال به API موفقیت‌آمیز بود"
   ```

2. **تست در صفحه**:
   ```
   1. صفحه‌ای با شورتکد [tabesh_ai_chat] بسازید
   2. رابط چت را باز کنید
   3. پیامی بفرستید
   4. انتظار: پاسخ سریع و دقیق از AI
   ```

3. **بررسی لاگ**:
   ```php
   // در wp-config.php فعال کنید:
   define('WP_DEBUG', true);
   define('WP_DEBUG_LOG', true);
   
   // بررسی کنید: wp-content/debug.log
   ```

### لینتینگ

```bash
composer phpcs -- templates/admin/admin-settings.php
```

**نکته**: فایل `admin-settings.php` خطاهای لینتینگ از قبل موجود دارد که مربوط به این تغییرات نیست. طبق دستورالعمل‌ها، فقط خطاهای مربوط به تغییرات جدید باید رفع شوند.

## مزایا

### 1. آخرین فناوری
- استفاده از جدیدترین مدل Google Gemini
- بهبودهای عملکرد و دقت
- پشتیبانی از ویژگی‌های جدید

### 2. سازگاری کامل
- کار در تمام حالت‌های عملکرد
- هیچ تغییر در کد API لازم نیست
- سازگار با نسخه‌های قبلی

### 3. آسان‌سازی استفاده
- انتخاب ساده از منوی کشویی
- تست اتصال یک کلیکی
- راهنمای کامل فارسی

## عیب‌یابی

### مشکل: خطای "مدل پیدا نشد"

**راه‌حل**:
1. اطمینان حاصل کنید که از آخرین نسخه کلید API استفاده می‌کنید
2. بررسی کنید که Google Gemini 2.5 در منطقه شما در دسترس است
3. لاگ‌های خطا را بررسی کنید

### مشکل: پاسخ کند

**راه‌حل**:
1. کش را فعال کنید (تنظیمات پیشرفته)
2. max_tokens را کاهش دهید
3. ممکن است مدل جدید نیاز به زمان بیشتری داشته باشد

### مشکل: خطای احراز هویت

**راه‌حل**:
1. کلید API را دوباره تولید کنید
2. اطمینان حاصل کنید که کلید برای Gemini API فعال شده است
3. تست اتصال را دوباره اجرا کنید

## ملاحظات امنیتی

### کلید API
- کلید API در دیتابیس ذخیره می‌شود
- با استفاده از متدهای امن وردپرس محافظت می‌شود
- هرگز در کد سمت کلاینت نشان داده نمی‌شود

### درخواست‌های API
- تمام درخواست‌ها از طریق HTTPS
- با nonce احراز هویت می‌شوند
- کنترل دسترسی بر اساس نقش کاربری

## پشتیبانی

### اطلاعات بیشتر
- **مستندات فارسی**: `docs/AI_SYSTEM_README.md`
- **مستندات انگلیسی**: `docs/AI_API_DOCUMENTATION.md`
- **پیاده‌سازی**: `AI_IMPLEMENTATION_COMPLETE.md`

### گزارش مشکل
- **ایمیل**: support@chapco.ir
- **وب‌سایت**: https://chapco.ir
- **GitHub**: Issue در مخزن

## نسخه

- **تاریخ**: 2025-12-24
- **نسخه**: 1.0.1
- **وضعیت**: ✅ تکمیل شده و آماده استفاده

## خلاصه تغییرات

```diff
+ افزودن گزینه gemini-2.5-flash به منوی انتخاب مدل
+ به‌روزرسانی مستندات برای شامل شدن مدل جدید
+ علامت‌گذاری gemini-2.5-flash به عنوان مدل توصیه شده
+ تست شده در تمام حالت‌های عملکرد (Direct، Server، Client)
```

---

**توجه**: تمام تغییرات با حداقل دخالت در کد انجام شده است. معماری موجود به قدری انعطاف‌پذیر طراحی شده بود که فقط افزودن یک گزینه در رابط کاربری کافی بود تا پشتیبانی کامل از مدل جدید فراهم شود.
