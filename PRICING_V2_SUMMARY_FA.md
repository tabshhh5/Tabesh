# ุจุงุฒุทุฑุงุญ ฺฉุงูู ูฺฉุงูุฒู ููุชฺฏุฐุงุฑ - ุฎูุงุตู ูพุงุฏูโุณุงุฒ

## ๐ ููุง ฺฉู (Summary)

ุงู Pull Request ฺฉ ุณุณุชู ููุชโฺฏุฐุงุฑ ูุงุชุฑฺฉุณ ุฌุฏุฏ (ูุณุฎู 2) ุฑุง ูุนุฑู ูโฺฉูุฏ ฺฉู ุฌุงฺฏุฒู ุณุณุชู ูุจู ูุจุชู ุจุฑ ุถุฑุงุจ ูพฺุฏู ุดุฏู ุงุณุช.

## โ ุขูฺู ูพุงุฏูโุณุงุฒ ุดุฏ

### 1. ููุชูุฑ ููุชโฺฏุฐุงุฑ ุฌุฏุฏ (Pricing Engine V2)

**ูุงู:** `includes/handlers/class-tabesh-pricing-engine.php`

ฺฉูุงุณ ุงุตู ูุญุงุณุจู ููุช ุจุง ูฺฺฏโูุง ุฒุฑ:
- โ ููุชโฺฏุฐุงุฑ ูุงุชุฑฺฉุณ ูุณุชูู ุจุฑุง ูุฑ ูุทุน ฺฉุชุงุจ
- โ ูุฒูู ูุฑ ุตูุญู = ฺฉุงุบุฐ + ฺุงูพ (ฺฉูพุงุฑฺูุ ุจุฏูู ุถุฑุจ)
- โ ูุฒูู ุตุญุงู ูุฎุตูุต ูุฑ ูุทุน
- โ ูุฒูู ุฌูุฏ ูุฎุตูุต ูุฑ ูุทุน
- โ ูพุดุชุจุงู ุงุฒ ูุญุฏูุฏุณุงุฒ ุชุฑฺฉุจุงุช ูพุงุฑุงูุชุฑูุง
- โ ฺฉุด ฺฉุฑุฏู ุฎูุฏฺฉุงุฑ ุจุฑุง ุจูููโุณุงุฒ ุนููฺฉุฑุฏ

### 2. ุฑุงุจุท ฺฉุงุฑุจุฑ ูุฏุฑุช

**ูุงูโูุง:**
- `includes/handlers/class-tabesh-product-pricing.php` - ฺฉูุงุณ ูุฏุฑุช
- `templates/admin/product-pricing.php` - ูุงูุจ ุฑุงุจุท ฺฉุงุฑุจุฑ

**ุดูุฑุช ฺฉุฏ ุฌุฏุฏ:** `[tabesh_product_pricing]`

ูฺฺฏโูุง ุฑุงุจุท ฺฉุงุฑุจุฑ:
- โ ููุงุด ูุถุนุช ููุชูุฑ ููุชโฺฏุฐุงุฑ (V1/V2)
- โ ุงูฺฉุงู ูุนุงู/ุบุฑูุนุงู ฺฉุฑุฏู ููุชูุฑ ุฌุฏุฏ
- โ ุงูุชุฎุงุจ ูุทุน ฺฉุชุงุจ ุงุฒ ุทุฑู ุชุจโูุง
- โ ูุฑู ูุงุชุฑุณ ููุชโฺฏุฐุงุฑ ุจุฑุง ูุฑ ูุทุน
- โ ุชูุธูุงุช ูุฒูู ุตูุญู (ฺฉุงุบุฐ ร ฺฏุฑูุงฺ ร ููุน ฺุงูพ)
- โ ุชูุธูุงุช ูุฒูู ุตุญุงู
- โ ุชูุธูุงุช ูุฒูู ุฌูุฏ
- โ ุชูุธูุงุช ุฎุฏูุงุช ุงุถุงู
- โ ฺฉูุชุฑูโูุง ูุญุฏูุฏุณุงุฒ ูพุงุฑุงูุชุฑูุง
- โ ุชูุธู ุญุงุดู ุณูุฏ

### 3. ุงุฏุบุงู ุจุง ุณุณุชู ูุนู

**ูุงู:** `includes/handlers/class-tabesh-order.php`

ุชุบุฑุงุช:
- โ ุชุดุฎุต ุฎูุฏฺฉุงุฑ ููุชูุฑ ูุนุงู (V1 ุง V2)
- โ ุงุณุชูุงุฏู ุงุฒ ููุชูุฑ V2 ุฏุฑ ุตูุฑุช ูุนุงู ุจูุฏู
- โ ุจุงุฒฺฏุดุช ุฎูุฏฺฉุงุฑ ุจู ููุชูุฑ V1 ุฏุฑ ุตูุฑุช ุบุฑูุนุงู ุจูุฏู
- โ ุญูุธ ฺฉุงูู ุณูุงุฑุดุงุช ูุจู

### 4. ุซุจุช ุดูุฑุชฺฉุฏ

**ูุงู:** `tabesh.php`

ุชุบุฑุงุช:
- โ ุงุถุงูู ฺฉุฑุฏู property ุจุฑุง `$product_pricing`
- โ ููุฏุงุฑุฏู ุงููู ฺฉูุงุณ `Tabesh_Product_Pricing`
- โ ุซุจุช ุดูุฑุชฺฉุฏ `[tabesh_product_pricing]`
- โ ูุชุฏ `render_product_pricing()` ุจุฑุง ููุงุด ุฑุงุจุท ฺฉุงุฑุจุฑ

### 5. ูุณุชูุฏุงุช ุฌุงูุน

**ูุงูโูุง ุงุฌุงุฏ ุดุฏู:**
- โ `PRICING_ENGINE_V2.md` - ูุณุชูุฏุงุช ฺฉุงูู ูู
- โ `TESTING_PRICING_V2.md` - ุฑุงูููุง ุชุณุช
- โ ุจุฑูุฒุฑุณุงู `README.md` ุจุง ุดูุฑุชฺฉุฏ ุฌุฏุฏ

## ๐ ุณุงุฎุชุงุฑ ููุชโฺฏุฐุงุฑ ุฌุฏุฏ

### ูุงุชุฑุณ ููุชโฺฏุฐุงุฑ ูุฑ ูุทุน

ูุฑ ูุทุน ฺฉุชุงุจ ุฏุงุฑุง ฺฉ ูุงุชุฑุณ ุฌุฏุงฺฏุงูู ุฏุฑ ูพุงฺฏุงู ุฏุงุฏู:

```
pricing_matrix_A5 = {
  "page_costs": {
    "ุชุญุฑุฑ": {
      "60": { "bw": 350, "color": 950 },
      "70": { "bw": 380, "color": 980 },
      "80": { "bw": 400, "color": 1000 }
    },
    "ุจุงูฺฉ": { ... }
  },
  "binding_costs": {
    "ุดููุฒ": 3000,
    "ุฌูุฏ ุณุฎุช": 8000
  },
  "cover_cost": 8000,
  "extras_costs": { ... },
  "profit_margin": 0.0,
  "restrictions": {
    "forbidden_paper_types": [],
    "forbidden_binding_types": [],
    "forbidden_print_types": {}
  }
}
```

### ูุฒุงุง ุณุงุฎุชุงุฑ ุฌุฏุฏ

#### ูุจู (V1):
```
ููุช ููุง = (((ูุฒูู ูพุงู ฺฉุงุบุฐ + ูุฒูู ฺุงูพ) ร ุถุฑุจ ูุทุน ร ุชุนุฏุงุฏ ุตูุญุงุช)
               + ูุฒูู ุฌูุฏ + ูุฒูู ุณูููู + ูุฒูู ุตุญุงู) ร ุชุฑุงฺ
```

**ูุดฺฉูุงุช:**
- โ ุถุฑุงุจ ูพฺุฏู ู ุบุฑุดูุงู
- โ ูุงุจุณุชฺฏ ุฒูุฌุฑูโุง ุงุดุชุจุงู
- โ ุฎุทุง ูุญุงุณุจุงุช ุจุงูุง
- โ ุบุฑูุงุจู ูุฏุฑุช

#### ุญุงูุง (V2):
```
ููุช ููุง = ((ูุฒูู ูุฑ ุตูุญู ร ุชุนุฏุงุฏ ุตูุญุงุช) + ูุฒูู ุฌูุฏ + ูุฒูู ุตุญุงู) ร ุชุฑุงฺ
```

**ูุฒุงุง:**
- โ ุดูุงู ู ุณุงุฏู
- โ ุจุฏูู ุถุฑุจ
- โ ูุฒูู ูุณุชูู ุจุฑุง ูุฑ ูุทุน
- โ ูุงุจู ูพุดโุจู ู ูุฏุฑุช

## ๐ ุงููุช

ุชูุงู ุจูุชุฑู ุฑูุดโูุง ุงููุช ุฑุนุงุช ุดุฏู:

- โ **Nonce Verification**: ุชุงุฏ nonce ูุจู ุงุฒ ูุฑฺฏููู sanitization
- โ **Input Sanitization**: ุชูุงู ูุฑูุฏโูุง ุจุง ุชูุงุจุน WordPress ูพุงฺฉุณุงุฒ ูโุดููุฏ
- โ **Output Escaping**: ุชูุงู ุฎุฑูุฌโูุง ุจุง `esc_html()`, `esc_attr()` ู ุบุฑู escape ูโุดููุฏ
- โ **Capability Checks**: ุจุฑุฑุณ `manage_woocommerce` ุจุฑุง ุฏุณุชุฑุณ ุจู ุชูุธูุงุช
- โ **Prepared Statements**: ุงุณุชูุงุฏู ุงุฒ `$wpdb->prepare()` ุจุฑุง ฺฉูุฆุฑโูุง
- โ **Translation Safety**: ุงุณุชูุงุฏู ุตุญุญ ุงุฒ ุชูุงุจุน ุชุฑุฌูู ุจุง placeholderโูุง

## ๐ ุณุงุฒฺฏุงุฑ ูุนฺฉูุณ (Backward Compatibility)

ุณุณุชู ฺฉุงููุงู ุณุงุฒฺฏุงุฑ ุจุง ูุณุฎู ูุจู ุงุณุช:

1. **ูพุดโูุฑุถ ุบุฑูุนุงู**: ููุชูุฑ V2 ุจู ุตูุฑุช ูพุดโูุฑุถ ุบุฑูุนุงู ุงุณุช
2. **ูุนุงูโุณุงุฒ ุงุฎุชุงุฑ**: ูุฏุฑ ูโุชูุงูุฏ ููุชูุฑ ุฌุฏุฏ ุฑุง ูุนุงู ฺฉูุฏ
3. **ุจุงุฒฺฏุดุช ุงูู**: ุฏุฑ ูุฑ ุฒูุงู ูโุชูุงู ุจู ููุชูุฑ ูุฏู ุจุงุฒฺฏุดุช
4. **ุญูุธ ุฏุงุฏูโูุง**: ุชูุธูุงุช ูุฏู ุญูุธ ูโุดูุฏ
5. **ุณูุงุฑุดุงุช ูุจู**: ูฺ ุชุงุซุฑ ุจุฑ ุณูุงุฑุดุงุช ุซุจุชโุดุฏู ูุจู ูุฏุงุฑุฏ

## ๐ ูููฺุงุฑุช ุชุตููโฺฏุฑ

```
ูุญุงุณุจู ููุช ุฏุฑุฎูุงุณุช ุดุฏ
        โ
ุขุง V2 ูุนุงู ุงุณุชุ
    โ         โ
  ุจูู          ุฎุฑ
    โ           โ
 ุงุณุชูุงุฏู     ุงุณุชูุงุฏู
 ุงุฒ V2       ุงุฒ V1
    โ           โ
 ูุชุฌู       ูุชุฌู
```

## ๐งช ูุญูู ุชุณุช

### ูุฑุญูู 1: ูุนุงูโุณุงุฒ
1. ุตูุญู ุฌุฏุฏ ุฏุฑ ูุฑุฏูพุฑุณ ุจุณุงุฒุฏ
2. ุดูุฑุชฺฉุฏ `[tabesh_product_pricing]` ุฑุง ุงุถุงูู ฺฉูุฏ
3. ุฑู ุฏฺฉูู "ูุนุงูโุณุงุฒ ููุชูุฑ ุฌุฏุฏ" ฺฉูฺฉ ฺฉูุฏ

### ูุฑุญูู 2: ูพฺฉุฑุจูุฏ
1. ฺฉ ูุทุน ฺฉุชุงุจ ุงูุชุฎุงุจ ฺฉูุฏ (ูุซูุงู A5)
2. ููุชโูุง ุฑุง ุจุฑุง ุชูุงู ูพุงุฑุงูุชุฑูุง ูุงุฑุฏ ฺฉูุฏ
3. ุชูุธูุงุช ุฑุง ุฐุฎุฑู ฺฉูุฏ

### ูุฑุญูู 3: ุชุณุช
1. ุงุฒ API ุจุฑุง ูุญุงุณุจู ููุช ุงุณุชูุงุฏู ฺฉูุฏ
2. ุจุฑุฑุณ ฺฉูุฏ ฺฉู `pricing_engine: "v2_matrix"` ุฏุฑ ูพุงุณุฎ ูุฌูุฏ ุฏุงุฑุฏ
3. ููุช ูุญุงุณุจูโุดุฏู ุฑุง ุจุง ุงูุชุธุงุฑุงุช ููุงุณู ฺฉูุฏ

ูุณุชูุฏุงุช ฺฉุงูู ุชุณุช ุฏุฑ `TESTING_PRICING_V2.md` ููุฌูุฏ ุงุณุช.

## ๐ ูุงูโูุง ุชุบุฑ ุงูุชู

### ูุงูโูุง ุฌุฏุฏ
- `includes/handlers/class-tabesh-pricing-engine.php` (546 ุฎุท)
- `includes/handlers/class-tabesh-product-pricing.php` (331 ุฎุท)
- `templates/admin/product-pricing.php` (421 ุฎุท)
- `PRICING_ENGINE_V2.md` (349 ุฎุท)
- `TESTING_PRICING_V2.md` (221 ุฎุท)
- `PRICING_V2_SUMMARY_FA.md` (ุงู ูุงู)

### ูุงูโูุง ูุฑุงุด ุดุฏู
- `tabesh.php` (+14 ุฎุท)
- `includes/handlers/class-tabesh-order.php` (+15 ุฎุท)
- `README.md` (+8 ุฎุท)

**ุฌูุน ฺฉู:** ~1900 ุฎุท ฺฉุฏ ุฌุฏุฏ

## โก ุนููฺฉุฑุฏ (Performance)

ุจูููโุณุงุฒโูุง ุงูุฌุงู ุดุฏู:
- โ ฺฉุด ฺฉุฑุฏู ูุงุชุฑุณ ููุชโฺฏุฐุงุฑ ุฏุฑ ุญุงูุธู
- โ ฺฉ ฺฉูุฆุฑ ุฏุชุงุจุณ ุจุฑุง ุจุงุฑฺฏุฐุงุฑ ฺฉุงูู ูุงุชุฑุณ
- โ ูพุงฺฉโุณุงุฒ ุฎูุฏฺฉุงุฑ ฺฉุด ููฺฏุงู ุจุฑูุฒุฑุณุงู
- โ ุจุฏูู ุชุงุซุฑ ุจุฑ ุนููฺฉุฑุฏ frontend

## ๐ ูุชุฌู

ุงู PR ฺฉ ุณุณุชู ููุชโฺฏุฐุงุฑ ุญุฑููโุงุ ูุงุจู ูุฏุฑุช ู ุงูู ุงุฑุงุฆู ูโุฏูุฏ ฺฉู:

1. **ุญุฐู ูพฺุฏฺฏ**: ุฏฺฏุฑ ูุงุฒ ุจู ุถุฑุงุจ ูพฺุฏู ูุณุช
2. **ุดูุงูุช**: ููุชโูุง ฺฉุงููุงู ูุงุจู ููู ู ูุฏุฑุช ูุณุชูุฏ
3. **ุงูุนุทุงู**: ูุฑ ูุทุน ฺฉุชุงุจ ููุชโฺฏุฐุงุฑ ูุณุชูู ุฏุงุฑุฏ
4. **ฺฉูุชุฑู**: ุงูฺฉุงู ูุญุฏูุฏุณุงุฒ ุชุฑฺฉุจุงุช ูุงูุนุชุจุฑ
5. **ุงููุช**: ุฑุนุงุช ฺฉุงูู ุงุณุชุงูุฏุงุฑุฏูุง ุงููุช WordPress
6. **ุณุงุฒฺฏุงุฑ**: ุจุฏูู ุชุงุซุฑ ุจุฑ ุณุณุชู ูุนู

## ๐ ฺฉุงุฑูุง ุขูุฏู (Future Work)

ูพุดููุงุฏุงุช ุจุฑุง ูุณุฎูโูุง ุจุนุฏ:
- [ ] ุงุจุฒุงุฑ ููุงุฌุฑุช ุฎูุฏฺฉุงุฑ ุงุฒ V1 ุจู V2
- [ ] ุฎุฑูุฌ/ูุฑูุฏ JSON ุจุฑุง ูพุดุชุจุงูโฺฏุฑ
- [ ] ุชุงุฑุฎฺู ุชุบุฑุงุช ููุช
- [ ] ูุงุดูโุญุณุงุจ ุชุณุช ุจุฑุง ูพุดโููุงุด ููุช
- [ ] ุจุฑูุฒุฑุณุงู ุฏุณุชูโุฌูุน ููุชโูุง

## ๐ค ูุดุงุฑฺฉุช

ุจุฑุง ฺฏุฒุงุฑุด ูุดฺฉู ุง ูพุดููุงุฏ:
- GitHub Issues: https://github.com/tabshhh3/Tabesh/issues
- ูุณุชูุฏุงุช: ูพูุดู `docs/`

---

**ูุณุฎู:** 1.0.0  
**ุชุงุฑุฎ:** ุฏโูุงู 1403  
**ุชูุณุนูโุฏููุฏฺฏุงู:** ุชู ุชูุณุนู ุชุงุจุด
